(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{hXNS:function(e,t,a){"use strict";a.r(t);var i,r=a("rFsW"),n=a("q1z7"),s=a.n(n),o=a("f3SV"),c=a("xi34"),d=a("OTSC"),m=a("ubkq"),u=a.n(m),l="other",g="free",p="none|direct|none|none|none",h={initialize:function(e){if(r.a.bindAll(this),r.a.extend(this,e),this.currentData=this._initCurrentData(),this.router||(this.router=RM.collectorRouter||RM.constructorRouter),this.currentData.userId&&!RM.common.isDownloadedSource){var t=this.currentData.userId;window.ga("readymag.set","&uid",t),window.ga("readymag.set","&cd9",t),window.ga("readymag.set","&cd11",this.currentData.subscription&&"free"===this.currentData.subscription?"NO":"SI"),window.ga("readymag.set","&cd13",this.currentData.gacid)}this.currentData.blurbUserCreationDate&&window.ga("readymag.set","&cd7",this.currentData.blurbUserCreationDate),RM.common.isDownloadedSource||Object(c.a)(this._saveLoginData),this.lastTrackedUrl="",Object(c.a)(r.a.bind((function(){this.trackPage()}),this))},sendEvent:function(e,t,a,i){if(window.ga&&(!RM.constructorRouter||!RM.constructorRouter.previewMode)){var n={action:e};r.a.isObject(t)?n=r.a.extend(n,t):(n.label=t||void 0,n.value=a||void 0);var s=this._extendParams(n);s.label&&"string"==typeof s.label&&s.label.match(/enterprise/)&&(s.label=s.label.replace(/enterprise/,"custom"));var o={hitType:"event",eventCategory:s.category,eventAction:s.action,eventLabel:s.label,eventValue:s.value,page:s.page,dimension1:s.dims.pageType,dimension3:s.dims.subscription,screenName:s.screenName,location:s.href,hitCallback:i||s.cb||void 0};s.dims.userId&&(o.dimension2=s.dims.userId),this._rmdata&&(o.dimension4=this._rmdata.dimension,o.dimension5=this._rmdata.first_campaign,o.dimension6=this._rmdata.first_medium);var c=this.getABTestingValue();c&&(o.dimension10=c),window.ga("readymag.send",o),this.sendFacebookPixelEvent(s.action,s)}},trackPage:function(e){if(window.ga&&(!RM.constructorRouter||!RM.constructorRouter.previewMode)){var t=this._extendParams(e);if(t.hitType="pageview",t.page!==this.lastTrackedUrl){this.lastTrackedUrl=t.page;var a={page:t.page,location:t.href,dimension1:t.dims.pageType,dimension3:t.dims.subscription,screenName:t.screenName,hitCallback:t.cb||void 0};t.dims.userId&&(a.dimension2=t.dims.userId),this._rmdata&&(a.dimension4=this._rmdata.dimension,a.dimension5=this._rmdata.first_campaign,a.dimension6=this._rmdata.first_medium);var i=this._getUserParam("blurb_reference_date"),r=this._getUserParam("stripe");i&&(r?"canceled"===r.subscription_status?a.dimension8="Cancelled":/_/g.test(r.subscription_id)&&(a.dimension8="Customer-"+r.subscription_id.split("_")[1]):a.dimension8="New user");var n=this.getABTestingValue();n&&(a.dimension10=n),window.ga("readymag.send","pageview",a),this.sendFacebookPixelEvent("PageView")}}},_initCurrentData:function(){var e={userId:null};window.ServerData.me&&(e.userId=window.ServerData.me._id||window.ServerData.me.user&&window.ServerData.me.user._id,e.userEmail=window.ServerData.me.email||window.ServerData.me.user&&window.ServerData.me.user.email,e.userFullName=window.ServerData.me.name||window.ServerData.me.user&&window.ServerData.me.user.name,e.subscription=this._getSubscription(),e.gacid=window.ServerData.me.user&&window.ServerData.me.user.gacid);var t=d.default.getCookie("_rmdata");t&&(this._rmdata=JSON.parse(atob(t)));var a=this._getUserParam("blurb_reference_date"),i=this._getUserParam("createDate");return a&&i&&(e.blurbUserCreationDate="blurb-"+u()(new Date(i),"yyyymmdd")),e},_getSubscription:function(){var e=window.ServerData.me.stripe&&window.ServerData.me.stripe.subscription_id||window.ServerData.me.user&&window.ServerData.me.user.stripe&&window.ServerData.me.user.stripe.subscription_id,t="",a="",i="";return e&&"none"!==e.toLowerCase()?((e=e.toLowerCase())&&/yearly/g.test(e)?i="yearly":e&&/monthly/g.test(e)&&(i="monthly"),a=(a=(a=(a=(a=(a=e).replace(/ /g,"")).replace(/_/g,"")).replace(/(yearly|monthly)/g,"")).replace(/plan/g,"")).trim(),t="paid"):(t="free",a=""),(t+" "+a+" "+i).trim()},_parseDimensions:function(e){var t={magId:e.magId||l,pageType:e.pageType||g,userId:e.userId||p};return e.magCreatorId&&(t.magCreatorId=e.magCreatorId),RM.constructorRouter&&!RM.constructorRouter.isOwner&&(t.pageType="constructor shared"),t.subscription=this.currentData.subscription||"free",t},_correctUrl:function(e){return"/"===e?e:"/"===e[e.length-1]?e.substr(0,e.length-1):e},_extendParams:function(e){var t=e||{};return t.dims=this.router.getAnalyticsDimensions&&this._parseDimensions(this.router.getAnalyticsDimensions()),t.page||(t.page="/"+s.a.history.getFragment()),-1!==t.page.indexOf("?")&&(t.page=t.page.substr(0,t.page.indexOf("?"))),t.page=this._correctUrl(t.page),t.href=window.location.href,t.action&&(t.category=this.getActionCategory(t.action)),t.label&&(t.label=t.label.toString()),t.screenName=this._setScreenName(),t},_saveLoginData:function(){var e=d.default.getCookie("send_join_event");if(e){e=JSON.parse(atob(e));var t=(new Date).valueOf(),a=d.default.getCookie("_rmdata");a=a?JSON.parse(atob(a)):{};var i={timestamp:t};d.default.sendFacebookPixelEvent(o.c.FacebookTrackingEvents.Join,{value:2,currency:"USD"}),d.default.trackTwitterConversion(o.c.TwitterTrackingEvents.Join),d.default.trackPinterestConversion(o.c.PinterestTrackingEvents.Join),r.a.extend(i,e,a),this._updateAnalyticsData(i),d.default.deleteCookie("send_join_event"),d.default.deleteCookie("_rmdata")}else d.default.deleteCookie("_rmdata")},_updateAnalyticsData:function(e){c.a.post("/api/me/analytics",{analytics_data:e})},_setScreenName:function(){var e;return RM.constructorRouter&&RM.constructorRouter.previewMode&&(e="Preview "+RM.constructorRouter.mag.get("num_id")),RM.constructorRouter&&!RM.constructorRouter.previewMode&&(e="Constructor "+RM.constructorRouter.mag.get("num_id")),RM.collectorRouter&&"shared-folder"!==RM.collectorRouter.currentView.mode&&(e="Profile ‘"+RM.collectorRouter.currentView.user.get("name")+"’"),RM.collectorRouter&&"shared-folder"===RM.collectorRouter.currentView.mode&&(e="Profile (shared folder) ‘"+RM.collectorRouter.currentView.user.get("name")+"’"),e},_getUserParam:function(e){return(this.router&&this.router.me&&this.router.me.attributes||{})[e]},getActionCategory:function(e){var t="";switch(e){case"Joined":case"Subscribed":case"Subscribe Error":case"Resumed Subscription":case"Changed Subscription":case"Coupon Applied":case"Cancelled Subscription":case"Cancelled Autorenew":t="Basic User Actions";break;case"Customer New":case"Customer":case"User (free)":t="Status of the day";break;case"Manage Subscription":case"Submit To Explore":case"Explore Tab Click":t="Homepage Actions";break;case"Animation Type Change":case"Animation Add Type":case"Animation Use Preset":case"Animation Choose Effect":case"Animation Trigger Click":case"Font Selector Show":case"Font Selector Switch to Category":case"Font Selector Show Custom Font Panel":case"Font Explorer Add/Remove from Library":case"Font Selector Edit List":case"Font Selector Custom Font Panel Select Weight":case"Font Selector Custom Font Panel Upload Weight":case"Font Selector Edit Custom Font":case"Create Mag Request":case"Create Mag":case"Publish Mag":case"Republish Mag":case"Unpublish Mag":case"Create Widget":case"Create Page":case"Page SEO Open":case"Page Sharing Open":case"Page Restored":case"Restore Defaults Sharing":case"Master Page Sharing":case"Help Open":case"Constructor Help Open":case"Code Editor Open":case"Code Editor Switch Tab":case"Code Editor Update":case"Code Editor Clear Switcher":case"Code Editor Use Iframe Switcher":case"Add Team Member":case"Delete Team Member":case"Picture Scale":case"Background Widget Type":case"Viewer Type Toggle":case"Viewer Options Toggle":case"Viewer Settings Learn More Click":case"Project Visible to Search Engines":case"Password Toggle":case"Set Project Password":case"Project Visibile to Visitors":case"Form Storage Connect Click":case"Form Storage Set Endpoint Param":case"Form Storage Successful OAuth Result":case"Map Domain":case"SSL Toggle":case"PDF Export":case"HTML Export":case"Set Project GA":case"Set Project GTM":case"GA Upgrade":case"Key Press":case"Restore to published":case"Picture Settings":case"Stripe":case"Viewports":case"Restore Layout":default:t="Process Actions"}return t}},w={sendFacebookPixelEvent:d.default.sendFacebookPixelEvent.bind(void 0),getABTestingValue:function(){return{a:"OLD",b:"NEW"}[d.default.getCookie("_rm_ab_group")]}},_=a("3eHG"),v="other",f=null,b={initialize:function(e){r.a.bindAll(this),r.a.extend(this,e),this.router||(this.router=RM.viewerRouter||RM.homepageRouter||RM.collectorRouter),this.lastTrackedUrl="",this.shortlink_redirect=d.default.getCookie("shortlink_redirect"),this._saveFirstInteraction(),RM.common.readymagTracker&&d.default.loadLoggedUser(r.a.bind((function(e){!r.a.isEmpty(e)&&window.ga&&(window.ga&&window.ga("readymag.set","&uid",e._id),this.userId=e._id)}),this))},sendEvent:function(e,t,a,i){if(window.gtag){var n={action:e};r.a.isObject(t)?n=r.a.extend(n,t):(n.label=t||void 0,n.value=a||void 0);var s=this._extendParams(n);s.label&&"string"==typeof s.label&&s.label.match(/enterprise/)&&(s.label=s.label.replace(/enterprise/,"custom"));var o={hitType:"event",eventCategory:s.category,eventAction:s.action,eventLabel:s.label,eventValue:s.value,page:s.page,location:s.href,screenName:s.screenName,hitCallback:i||s.cb||void 0};if(RM.common.readymagTracker){o.dimension1=s.dims&&s.dims.pageType,s.dims&&s.dims.userId&&(o.dimension2=s.dims.userId),o.dimension3=null,this._rmdata&&(o.dimension4=this._rmdata.dimension,o.dimension5=this._rmdata.first_campaign,o.dimension6=this._rmdata.first_medium);var c=this.getABTestingValue();c&&(o.dimension10=c),window.gtag("event",o.eventAction,{event_category:o.eventCategory,event_label:o.eventLabel,pageType:s.dims&&s.dims.pageType,userId:s.dims&&s.dims.userId,dimension:this._rmdata&&this._rmdata.dimension,firstCampaign:this._rmdata&&this._rmdata.first_campaign,firstMedium:this._rmdata&&this._rmdata.first_medium,abTestingValue:this.getABTestingValue(),campaign:{name:this._rmdata&&this._rmdata.first_campaign,source:this._rmdata&&this._rmdata.first_source,medium:this._rmdata&&this._rmdata.first_medium}})}return RM.common.userTracker&&"Project Actions"===s.category&&window.gtag("event",o.eventAction,{event_category:o.eventCategory,event_label:o.eventLabel,value:o.eventValue}),RM.common.isDomainViewer||this.sendFacebookPixelEvent(s.action,s),o}},trackPage:function(e){if(window.gtag){var t=this._extendParams(e);if(this.shortlink_redirect&&(t=r.a.extend(t,this._processRedirectUTM())),t.page!==this.lastTrackedUrl||RM.common.homepageRewrite){this.lastTrackedUrl=t.page;var a={page:t.page,location:t.href,screenName:t.screenName,campaignName:t.campaignName,campaignSource:t.campaignSource,campaignMedium:t.campaignMedium,hitCallback:t.cb||void 0};if(RM.common.readymagTracker){a.dimension1=t.dims&&t.dims.pageType,t.dims&&t.dims.userId&&(a.dimension2=t.dims.userId),a.dimension3=null,a.metric1=t.countProjectView,this._rmdata&&(a.dimension4=this._rmdata.dimension,a.dimension5=this._rmdata.first_campaign,a.dimension6=this._rmdata.first_medium);var i=this.getABTestingValue();i&&(a.dimension10=i),window.gtag("event","page_view",{page_title:window.document.title,page_location:t.location,pageType:t.dims&&t.dims.pageType,userId:t.dims&&t.dims.userId,dimension:this._rmdata&&this._rmdata.dimension,firstCampaign:this._rmdata&&this._rmdata.first_campaign,firstMedium:this._rmdata&&this._rmdata.first_medium,abTestingValue:this.getABTestingValue(),campaign:{name:this._rmdata&&this._rmdata.first_campaign,source:this._rmdata&&this._rmdata.first_source,medium:this._rmdata&&this._rmdata.first_medium}})}return RM.common.userTracker&&window.gtag("event","page_view",{page_title:window.document.title,page_location:t.location}),RM.common.isDomainViewer||this.sendFacebookPixelEvent("PageView"),a}}},_extendParams:function(e){var t=e||{};return RM.common.isDownloadedSource||RM.common.homepageRewrite||(t.dims=this.router.getAnalyticsDimensions&&this._parseDimensions(this.router.getAnalyticsDimensions())),this.userId&&t.dims&&(t.dims.userId=this.userId),t.page||RM.common.isDownloadedSource||RM.common.homepageRewrite?t.page||!RM.common.isDownloadedSource||RM.common.homepageRewrite||(t.page=s.a.history.location.pathname):t.page="/"+s.a.history.getFragment(),t.page&&-1!==t.page.indexOf("?")&&(t.page=t.page.substr(0,t.page.indexOf("?"))),t.page=this._correctUrl(t.page||""),t.href=window.location.href,t.action&&!t.category&&(t.category=this.getActionCategory(t.action)),this._triggerProjectView&&!t.action&&(t.countProjectView=1,this._triggerProjectView=!1),t.screenName=this._setScreenName(),t},_correctUrl:function(e){return"/"===e?e:"/"===e[e.length-1]?e.substr(0,e.length-1):e},_setScreenName:function(){var e;return RM.viewerRouter&&RM.viewerRouter.mag&&RM.viewerRouter.magPasswordView&&RM.viewerRouter.mag.is_private&&(e="Private project "+RM.viewerRouter.mag.num_id),RM.viewerRouter&&RM.viewerRouter.mag&&!RM.viewerRouter.mag.is_private&&(e=RM.viewerRouter.mag.title),e},_parseDimensions:function(e){return{pageType:e.pageType||v,userId:e.userId,subscription:e.subscription||f}},_processRedirectUTM:function(){if(this.shortlink_redirect){var e=JSON.parse(atob(this.shortlink_redirect));return d.default.deleteCookie("shortlink_redirect"),{campaignName:e.utm_campaign,campaignSource:e.utm_source,campaignMedium:e.utm_medium}}},_saveFirstInteraction:function(){var e=this;if(Boolean(d.default.getCookie("_rm_uid")))d.default.deleteCookie("_rmdata");else{var t=d.default.getCookie("_rmdata");if(t)return this._rmdata=JSON.parse(atob(t)),void this.trackPage();_.a.waitForCookieConsent().then((function(t){if(t.statistics){var a=document.referrer||"direct",i=encodeURI(window.location.href),r=d.default.queryUrlGetParam("utm_campaign"),n=d.default.queryUrlGetParam("utm_source"),s=d.default.queryUrlGetParam("utm_medium"),o={dimension:[r,n,s,a,i].join("|"),first_medium:s,first_campaign:r,first_source:n,rm_url:i,rm_referrer:a},c=btoa(JSON.stringify(o));e._rmdata=o,d.default.createCookie("_rmdata",c),e.trackPage()}}))}},getActionCategory:function(e){return RM.homepageRouter?"Homepage Actions":"First Widget Pack Loaded"===e?"Performance":"Project Actions"}};if(location.origin===o.c.readymag_auth_host&&h?i=s.a.Model.extend(r.a.extend(r.a.extend({},h),w)):b?i=s.a.Model.extend(r.a.extend(r.a.extend({},b),w)):console.error("Analytics initialization error!"),window.RM&&window.RM.customAnalyticsHandlers&&!r.a.isEmpty(window.RM.customAnalyticsHandlers.event)){var R=i.prototype.sendEvent;i.prototype.sendEvent=function(){if(window.ga){var e=R.apply(this,arguments);return window.RM.customAnalyticsHandlers&&r.a.isFunction(window.RM.customAnalyticsHandlers.run)&&window.RM.customAnalyticsHandlers.run("event",e),e}}}if(window.RM&&window.RM.customAnalyticsHandlers&&!r.a.isEmpty(window.RM.customAnalyticsHandlers.track)){var y=i.prototype.trackPage;i.prototype.trackPage=function(){if(window.ga){var e=y.apply(this,arguments);return e&&window.RM.customAnalyticsHandlers&&r.a.isFunction(window.RM.customAnalyticsHandlers.run)&&window.RM.customAnalyticsHandlers.run("track",e),e}}}t.default=i}}]);